---
import type BlogPost from "@content/config.ts";
import { getCollection } from "astro:content";
import { findPostsInSeries } from "@lib/blog.ts";
import { slugifyUrl } from "@lib/utils.ts";
import BaseLayout from "@layouts/BaseLayout.astro";

const posts: BlogPost[] = await getCollection("blog", ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true;
});
const allPostsWithSeries = posts.filter(
  (post: BlogPost) => post.data.series !== undefined,
);

const seriesNames = [
  ...new Set(allPostsWithSeries.map((post: BlogPost) => post.data.series.name)),
];

const seriesDescriptions = [
  ...new Set(
    allPostsWithSeries.map((post: BlogPost) => post.data.series.description),
  ),
];

const series = seriesNames.reduce(
  (acc, index, cV) => [
    {
      ...acc,
      name: index,
      description: seriesDescriptions[cV],
      posts: findPostsInSeries(index, allPostsWithSeries),
    },
  ],
  {},
);

//console.log(series[0].posts);
---

<BaseLayout
  title="All Series"
  description="A list of all the series on the blog."
/>
